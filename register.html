<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link rel="icon" href="img/cert.png">
    <link rel="stylesheet" href="style.css">

    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
        (function () {
            emailjs.init("YOUR_PUBLIC_KEY");
        })();
    </script>
</head>

<body style="background-color:white;">
<br>

<div class="nex">
    <h1 class="nexus">Get Nexus Account</h1>
</div>

<section class="forme">
<form id="registerForm">

    <div class="me1">
        <input type="text" name="name" class="input1" placeholder="Name-eg-franklin1523" required>
    </div><br>

    <div class="me1">
        <input type="password" name="password" class="input1" placeholder="Password" required>
    </div><br>

    <div class="me1">
        <input type="password" name="confirmPassword" class="input1" placeholder="Confirm password" required>
    </div><br>

    <div class="me1">
        <input type="email" name="email" class="input1" placeholder="Email" required>
    </div><br>

    <div class="me1">
        <input type="text" name="bitcoinWallet" class="input1" placeholder="Bitcoin wallet address" required>
    </div><br>

    <div class="me1">
        <input type="text" name="ethWallet" class="input1" placeholder="Eth wallet address" required>
    </div><br>

    <div class="me1">
        <input type="text" name="dogeAddress" class="input1" placeholder="Doge address" required>
    </div><br>

    <div class="me1">
        <input type="text" name="whorefcode" class="input1" placeholder="Who Refered you code (Optional)">
    </div><br>

    <div class="me1">
        <input type="checkbox" required>
        I accept Nexus Company
        <a href="terms.html" style="color:#ff6b6b;text-decoration:none;">terms of service</a>
    </div><br>

    <div class="mit">
        <button type="submit" class="mity"><b>Submit</b></button>
    </div>
</form>

<br>
<div id="errorMessage" style="color:red;text-align:center;"></div>
<div id="successMessage" style="color:green;text-align:center;"></div>
</section>

<script>
/* Redirect if already logged in */
if (localStorage.getItem("user")) {
    window.location.href = "./dash.html";
}

document.getElementById("registerForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);

    document.getElementById("errorMessage").innerText = "";

    if (data.password !== data.confirmPassword) {
        document.getElementById("errorMessage").innerText = "Passwords do not match";
        return;
    }

    /* ===== SAVE TO LOCAL STORAGE ===== */
    const user = {
        id: "USR_" + Date.now(),
        name: data.name,
        email: data.email,
        bitcoinWallet: data.bitcoinWallet,
        ethWallet: data.ethWallet,
        dogeAddress: data.dogeAddress,
        whorefcode: data.whorefcode || "",
        balance: 0,
        earning: 0,
        isAdmin: false,
        myRefCode: "REF" + Math.random().toString(36).substring(2, 8).toUpperCase()
    };

    localStorage.setItem("user", JSON.stringify(user));

    /* ===== SEND TO GMAIL ===== */
    emailjs.sendForm(
        "YOUR_SERVICE_ID",
        "YOUR_TEMPLATE_ID",
        form
    ).then(() => {
        document.getElementById("successMessage").innerText =
            "Registration successful! Redirecting...";
        setTimeout(() => {
            window.location.href = "./dash.html";
        }, 2000);
    }).catch(() => {
        document.getElementById("errorMessage").innerText =
            "Email sending failed, but account was saved.";
    });
});
</script>

</body>
</html>
