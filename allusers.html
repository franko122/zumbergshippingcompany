<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Users</title>
    <link rel="icon" href="img/cert.png">
    <link rel="stylesheet" href="style.css">
</head>
<body class="whity">
    <br>
    <div style="text-align: center;">
        <b style="color: white;">All Users</b>
    </div>
    <br>
    <div id="usersTableContainer" style="margin: auto; width: 90%;">
        <table id="usersTable" style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #1e3c72; color: white;">
                    <th style="padding: 10px; border: 1px solid #ddd;">Name</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">Email</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">Balance</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">Earning</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">Actions</th>
                </tr>
            </thead>
            <tbody id="usersTableBody">
                <!-- Users will be populated here -->
            </tbody>
        </table>
    </div>

    <script>
        async function fetchUsers() {
            try {
                const response = await fetch('https://api.example.com/users');
                const users = await response.json();
                displayUsers(users);
            } catch (error) {
                console.error('Error fetching users:', error);
                alert('Failed to fetch users');
            }
        }

        function displayUsers(users) {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="padding: 10px; border: 1px solid #ddd;">${user.name || user.username}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${user.email}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${user.balance || 0}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">${user.earning || 0}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">
                        <button onclick="deleteUser('${user.id}')" style="margin: 2px; background: #ff6b6b; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Delete</button>
                        <button onclick="addBalance('${user.id}', ${user.balance || 0})" style="margin: 2px; background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Add Balance</button>
                        <button onclick="addEarning('${user.id}', ${user.earning || 0})" style="margin: 2px; background: #2196F3; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Add Earning</button>
                        <button onclick="minusBalance('${user.id}', ${user.balance || 0})" style="margin: 2px; background: #FF9800; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Minus Balance</button>
                        <button onclick="minusEarning('${user.id}', ${user.earning || 0})" style="margin: 2px; background: #9C27B0; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Minus Earning</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        } 
        async function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                try {
                    const response = await fetch(`https://nodebackendnew.vercel.app/getAllUsers${userId}`, {
                        method: 'DELETE'
                    });
                    if (response.ok) {
                        alert('User deleted');
                        fetchUsers(); // Refresh the table
                    } else {
                        alert('Failed to delete user');
                    }
                } catch (error) {
                    console.error('Error deleting user:', error);
                    alert('Error deleting user');
                }
            }
        }

        async function addBalance(userId, currentBalance) {
            const amount = prompt('Enter amount to add to balance:');
            if (amount && !isNaN(amount)) {
                const newBalance = parseFloat(currentBalance) + parseFloat(amount);
                await updateUser(userId, { balance: newBalance });
            }
        }

        async function addEarning(userId, currentEarning) {
            const amount = prompt('Enter amount to add to earning:');
            if (amount && !isNaN(amount)) {
                const newEarning = parseFloat(currentEarning) + parseFloat(amount);
                await updateUser(userId, { earning: newEarning });
            }
        }

        async function minusBalance(userId, currentBalance) {
            const amount = prompt('Enter amount to subtract from balance:');
            if (amount && !isNaN(amount)) {
                const newBalance = parseFloat(currentBalance) - parseFloat(amount);
                await updateUser(userId, { balance: newBalance });
            }
        }

        async function minusEarning(userId, currentEarning) {
            const amount = prompt('Enter amount to subtract from earning:');
            if (amount && !isNaN(amount)) {
                const newEarning = parseFloat(currentEarning) - parseFloat(amount);
                await updateUser(userId, { earning: newEarning });
            }
        }

        async function updateUser(userId, updates) {
            try {
                const response = await fetch(`https://api.example.com/users/${userId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updates)
                });
                if (response.ok) {
                    alert('Updated successfully');
                    fetchUsers(); // Refresh the table
                } else {
                    alert('Failed to update');
                }
            } catch (error) {
                console.error('Error updating user:', error);
                alert('Error updating user');
            }
        }

        // Fetch users on page load
        window.onload = fetchUsers;
    </script>
</body>
</html>