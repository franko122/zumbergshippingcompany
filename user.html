<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users</title>
    <link rel="icon" href="img/cert.png">
    <link rel="stylesheet" href="style.css">
</head>
<body style="background-color: black; color: white;"> 
    <br>
    <div class="features">
        <h2 style="color: white; text-align: center;">All Users</h2>
        <div class="table-container">
            <table id="usersTable" style="width: 100%; border-collapse: collapse; color: white;">
                <thead>
                    <tr style="background-color: #333;">
                        <th style="padding: 10px; border: 1px solid #555;">Name</th>
                        <th style="padding: 10px; border: 1px solid #555;">Email</th>
                        <th style="padding: 10px; border: 1px solid #555;">Balance</th>
                        <th style="padding: 10px; border: 1px solid #555;">Earning</th>
                        <th style="padding: 10px; border: 1px solid #555;">Admin</th>
                        <th style="padding: 10px; border: 1px solid #555;">Ref Code</th>
                        <th style="padding: 10px; border: 1px solid #555;">Who Ref Code</th>
                        <th style="padding: 10px; border: 1px solid #555;">Wallets</th>
                        <th style="padding: 10px; border: 1px solid #555;">Created</th>
                        <th style="padding: 10px; border: 1px solid #555;">Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <!-- Users will be displayed here -->
                </tbody>
            </table>
        </div>
            <div class="today">   
    <div id="adminControls" style="text-align: center; display: none;">
        <button style="background: #007bff; color: white; border: none; padding: 10px 20px; cursor: pointer;">  <a href="admincontol.html" style="color: white; text-decoration: none;">Admin Control</a></button>
    </div>
    </div>
    </div>



        <script>
            // Validate if user exists and is admin
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user || !user.isAdmin) {
                window.location.href = './dash.html';
            }
            // Fetch and display users
            fetch('https://nodebackendnew.vercel.app/investuser', {
                mode: 'cors'
            })
                .then(response => response.json())
                .then(users => {
                    const tbody = document.getElementById('usersTableBody');
                    users.forEach(user => {
                        const row = document.createElement('tr');
                        row.style.backgroundColor = '#222';
                        row.innerHTML = `
                            <td style="padding: 10px; border: 1px solid #555;">${user.name}</td>
                            <td style="padding: 10px; border: 1px solid #555;">${user.email}</td>
                            <td style="padding: 10px; border: 1px solid #555;">$${user.balance}</td>
                            <td style="padding: 10px; border: 1px solid #555;">$${user.earning || 0}</td>
                            <td style="padding: 10px; border: 1px solid #555;">${user.isAdmin ? 'Yes' : 'No'}</td>
                            <td style="padding: 10px; border: 1px solid #555;">${user.refCode}</td>
                            <td style="padding: 10px; border: 1px solid #555;">${user.whorefcode || 'N/A'}</td>
                            <td style="padding: 10px; border: 1px solid #555;">
                                BTC: ${user.bitcoinWallet}<br>
                                ETH: ${user.ethWallet}<br>
                                DOGE: ${user.dogeAddress}
                            </td>
                            <td style="padding: 10px; border: 1px solid #555;">${new Date(user.createdAt).toLocaleDateString()}</td>
                            <td style="padding: 10px; border: 1px solid #555;">
                                <button onclick="addFunds('${user._id}')" style="background: green; color: white; border: none; padding: 5px 10px; margin: 2px; border-radius: 4px; cursor: pointer;">Add Funds</button>
                                <button onclick="minusFunds('${user._id}')" style="background: orange; color: white; border: none; padding: 5px 10px; margin: 2px; border-radius: 4px; cursor: pointer;">Minus Funds</button>
                                <button onclick="addEarning('${user._id}')" style="background: blue; color: white; border: none; padding: 5px 10px; margin: 2px; border-radius: 4px; cursor: pointer;">Add Earning</button>
                                <button onclick="minusEarning('${user._id}')" style="background: purple; color: white; border: none; padding: 5px 10px; margin: 2px; border-radius: 4px; cursor: pointer;">Minus Earning</button>
                                <button onclick="deleteUser('${user._id}')" style="background: red; color: white; border: none; padding: 5px 10px; margin: 2px; border-radius: 4px; cursor: pointer;">Delete</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(error => console.error('Error fetching users:', error));

         
         function addFunds(userId) {
             const amount = prompt('Enter amount to add:');
             if (amount && !isNaN(amount)) {
                 if (confirm(`Are you sure you want to add $${amount} to this user?`)) {
                     fetch(`https://nodebackendnew.vercel.app/user/${userId}/add-funds`, {
                         method: 'PUT',
                         headers: { 'Content-Type': 'application/json' },
                         mode: 'cors',
                         body: JSON.stringify({ amount: parseFloat(amount) })
                     })
                     .then(response => response.json())
                     .then(data => {
                         alert(data.message);
                         location.reload(); // Reload to update balances
                     })
                     .catch(error => console.error('Error:', error));
                 }
             }
         }

         function minusFunds(userId) {
             const amount = prompt('Enter amount to subtract:');
             if (amount && !isNaN(amount)) {
                 if (confirm(`Are you sure you want to subtract $${amount} from this user?`)) {
                     fetch(`https://nodebackendnew.vercel.app/user/${userId}/minus-funds`, {
                         method: 'PUT',
                         headers: { 'Content-Type': 'application/json' },
                         mode: 'cors',
                         body: JSON.stringify({ amount: parseFloat(amount) })
                     })
                     .then(response => response.json())
                     .then(data => {
                         alert(data.message);
                         location.reload(); // Reload to update balances
                     })
                     .catch(error => console.error('Error:', error));
                 }
             }
         }

         function addEarning(userId) {
             const amount = prompt('Enter earning amount to add:');
             if (amount && !isNaN(amount)) {
                 if (confirm(`Are you sure you want to add $${amount} to earning for this user?`)) {
                     fetch(`https://nodebackendnew.vercel.app/user/${userId}/add-earning`, {
                         method: 'PUT',
                         headers: { 'Content-Type': 'application/json' },
                         mode: 'cors',
                         body: JSON.stringify({ amount: parseFloat(amount) })
                     })
                     .then(response => response.json())
                     .then(data => {
                         alert(data.message);
                         location.reload(); // Reload to update
                     })
                     .catch(error => console.error('Error:', error));
                 }
             }
         }

         function minusEarning(userId) {
             const amount = prompt('Enter earning amount to subtract:');
             if (amount && !isNaN(amount)) {
                 if (confirm(`Are you sure you want to subtract $${amount} from earning for this user?`)) {
                     fetch(`https://nodebackendnew.vercel.app/user/${userId}/minus-earning`,  {
                         method: 'PUT',
                         headers: { 'Content-Type': 'application/json' },
                         mode: 'cors',
                         body: JSON.stringify({ amount: parseFloat(amount) })
                     })
                     .then(response => response.json())
                     .then(data => {
                         alert(data.message);
                         location.reload(); // Reload to update
                     })
                     .catch(error => console.error('Error:', error));
                 }
             }
         }

         function deleteUser(userId) {
             if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                 fetch(`https://nodebackendnew.vercel.app/user/${userId}`, {
                     method: 'DELETE',
                     mode: 'cors'
                 })
                 .then(response => response.json())
                 .then(data => {
                     alert(data.message);
                     location.reload(); // Reload to update list
                 })
                 .catch(error => console.error('Error:', error));
             }
         }
    </script>
<!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/6931c983b40f0c197a3061c9/1jbl7mcoa';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->
</body>
</html>